# Курсовой проект

Этот репозиторий содержит курсовой проект, включающий основной сервис на Java (Spring Boot) и сервис аутентификации на
Go. Взаимодействие между сервисами осуществляется посредством gRPC. Проект контейнеризирован с использованием Docker и
Docker Compose.

## Ссылка на ТЗ:

https://git.culab.ru/bsc-development-basics-2nd-semester/dev-basics-2025-longreads/-/tree/main/course-project?ref_type=heads

## Технологии

* **Java (Spring Boot):** Используется для разработки основного сервиса.
* **Go:** Используется для разработки сервиса аутентификации и взаимодействия с пользовательскими данными.
* **gRPC:** Применяется для межсервисного взаимодействия между Java-сервисом и Go-сервисом.
* **Protobuf (Protocol Buffers):** Используется для определения контрактов gRPC сервисов.
* **Docker & Docker Compose:** Применяются для контейнеризации и оркестрации приложений.
* **PostgreSQL:** Хранение данных для обоих сервисов (пользователи и все связанное с книгами).
* **Gradle:** Система автоматической сборки для Java-проекта.

## Структура проекта

```
.
├── api/                        # Определения Protobuf для gRPC
│   └── auth.proto
├── docker-compose.yml          # Файл Docker Compose для запуска всех сервисов
├── go-auth/                    # Сервис аутентификации на Go
│   ├── Dockerfile              # Dockerfile для сборки Go-сервиса
│   ├── Readme.md               # README для Go-сервиса
│   ├── cmd/
│   │   └── server/
│   │       └── server.go       # Основной файл для запуска Go-сервера
│   ├── internal/               # Внутренняя логика Go-сервиса
│   │   ├── addAdmin/           # Логика добавления администратора
│   │   ├── db/                 # Логика взаимодействия с базой данных
│   │   ├── generated/          # Сгенерированный gRPC код для Go
│   │   ├── hash/               # Утилиты для хеширования паролей
│   │   ├── jwt/                # Логика для работы с JWT токенами
│   │   └── service/            # Реализация gRPC сервиса
│   ├── go.mod                  # Файл управления зависимостями Go
│   └── go.sum
├── java-main-service/          # Основной сервис на Java (Spring Boot)
│   ├── Dockerfile              # Dockerfile для сборки Java-сервиса
│   ├── build.gradle.kts        # Файл сборки Gradle
│   ├── gradlew                 # Gradle wrapper (Linux/macOS)
│   ├── gradlew.bat             # Gradle wrapper (Windows)
│   ├── settings.gradle.kts
│   ├── src/
│   │   ├── main/
│   │   │   └── java/           # Исходный код Java
│   │   │       └── books/java_main_service/ # Основной пакет приложения
│   │   └── test/               # Unit-тесты
│   └── build/                  # Директория сборки проекта (обычно игнорируется Git)
└── README.md                   # Этот файл
```

## Запуск проекта

Для запуска проекта убедитесь, что у вас установлены Docker и Docker Compose, компилятор Proto и работают `Makefile`.

### Запуск сервисов через консоль без Makefile:

1.**Сгенерируйте файлы для сервиса на Go:**
Используйте команду go generate:

   ```bash
   go generate ./api/gen.go
   ```

2.**Соберите и запустите сервисы:**
Используйте Docker Compose для сборки образов и запуска контейнеров:

   ```bash
   docker-compose up --build -d
   ```

2.**Проверка статуса контейнеров:**

   ```bash
   docker-compose ps
   ```

4. **Остановка сервисов:**
   ```bash
   docker-compose down
   ```

### Запуск сервисов через консоль с Makefile:

1.**Запуск с предзагрузкой proto-файлов:**

   ```bash
   make all
   ```

2. **Остановка сервисов:**

   ```bash
   make down
   ```

## Добавление администратора:

* **Добавление администратора:**
  Для добавления нового администратора в систему (например, для первоначальной настройки), используйте следующую команду
  после запуска контейнеров:
  ```bash
  docker-compose exec auth-service add
  ```
  Эта команда выполнит скрипт или функцию внутри контейнера `auth-service`, отвечающую за добавление администратора.
