package books.java_main_service;import books.java_main_service.controller.AdminDealController;import books.java_main_service.model.Deal;import books.java_main_service.model.TotalDeals;import books.java_main_service.service.DealService;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import org.mockito.InjectMocks;import org.mockito.Mock;import org.mockito.MockitoAnnotations;import org.springframework.test.web.servlet.MockMvc;import org.springframework.test.web.servlet.setup.MockMvcBuilders;import org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver;import java.time.LocalDateTime;import java.util.Collections;import java.util.List;import static org.mockito.ArgumentMatchers.eq;import static org.mockito.Mockito.when;import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;class AdminDealControllerTest {    private MockMvc mockMvc;    @Mock private DealService dealService;    @InjectMocks private AdminDealController adminDealController;    private Deal testDeal;    private TotalDeals testTotalDeals;    private String testAccessToken;    @BeforeEach    void setUp() {        MockitoAnnotations.openMocks(this);        // Настройка обработчика исключений        ExceptionHandlerExceptionResolver exceptionResolver =                new ExceptionHandlerExceptionResolver();        exceptionResolver.afterPropertiesSet();        mockMvc =                MockMvcBuilders.standaloneSetup(adminDealController)                        .setHandlerExceptionResolvers(exceptionResolver)                        .build();        // Настройка ObjectMapper        ObjectMapper objectMapper = new ObjectMapper();        objectMapper.registerModule(new JavaTimeModule());        // Подготовка тестовых данных        testDeal = new Deal();        testDeal.setId(1L);        testDeal.setInitiatorId(1L);        testDeal.setReceiverId(2L);        testDeal.setStatus(Deal.DealStatus.PROPOSED);        testDeal.setCreatedAt(LocalDateTime.now());        testTotalDeals = new TotalDeals(1L);        testTotalDeals.setTotalDeals(5);        testTotalDeals.setSuccessfulDeals(3);        testAccessToken = "Bearer test_access_token";    }    @Test    void getAllTotalDeals() throws Exception {        List<TotalDeals> totalDealsList = Collections.singletonList(testTotalDeals);        when(dealService.getAllTotalDeals(eq(testAccessToken))).thenReturn(totalDealsList);        mockMvc.perform(get("/api/admin/deals/statistics").header("Authorization", testAccessToken))                .andExpect(status().isOk())                .andExpect(jsonPath("$[0].userId").value(testTotalDeals.getUserId()))                .andExpect(jsonPath("$[0].totalDeals").value(testTotalDeals.getTotalDeals()))                .andExpect(                        jsonPath("$[0].successfulDeals")                                .value(testTotalDeals.getSuccessfulDeals()));    }    @Test    void getUserDeals() throws Exception {        List<Deal> deals = Collections.singletonList(testDeal);        when(dealService.getAllDeals(eq(testAccessToken), eq(1L))).thenReturn(deals);        mockMvc.perform(get("/api/admin/deals/user/1").header("Authorization", testAccessToken))                .andExpect(status().isOk())                .andExpect(jsonPath("$[0].id").value(testDeal.getId()))                .andExpect(jsonPath("$[0].initiatorId").value(testDeal.getInitiatorId()))                .andExpect(jsonPath("$[0].receiverId").value(testDeal.getReceiverId()))                .andExpect(jsonPath("$[0].status").value(testDeal.getStatus().toString()));    }}