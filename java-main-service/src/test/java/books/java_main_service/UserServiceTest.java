package books.java_main_service;import books.java_main_service.model.*;import books.java_main_service.service.GrpcClientService;import books.java_main_service.service.UserService;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.Test;import org.junit.jupiter.api.extension.ExtendWith;import org.mockito.InjectMocks;import org.mockito.Mock;import org.mockito.junit.jupiter.MockitoExtension;import static org.junit.jupiter.api.Assertions.assertEquals;import static org.mockito.ArgumentMatchers.*;import static org.mockito.Mockito.when;@ExtendWith(MockitoExtension.class)class UserServiceTest {    @Mock private GrpcClientService grpcClientService;    @InjectMocks private UserService userService;    private Auth.UserProfileWithTokens mockUserProfileWithTokens;    private Auth.UserProfile mockUserProfile;    private Auth.UserMainDataResponse mockUserMainData;    private final String testToken = "Bearer testToken";    @BeforeEach    void setUp() {        mockUserProfileWithTokens =                Auth.UserProfileWithTokens.newBuilder()                        .setId(1L)                        .setLogin("OPTIMUS")                        .setRole(Auth.UserType.CLIENT)                        .setMail("test@cu.com")                        .setPhone("+79991234567")                        .setAccessToken("accessTokenus")                        .setRefreshToken("refreshTokenus")                        .build();        mockUserProfile =                Auth.UserProfile.newBuilder()                        .setId(1L)                        .setLogin("testUser")                        .setRole(Auth.UserType.CLIENT)                        .setMail("test@cu.com")                        .setPhone("+79991234567")                        .build();        mockUserMainData =                Auth.UserMainDataResponse.newBuilder()                        .setId(1L)                        .setRole(Auth.UserType.CLIENT)                        .build();    }    @Test    void createUserShouldReturnAuthResult() {        UserLoginDTO loginDTO = new UserLoginDTO("OPTIMUS", "password123");        when(grpcClientService.addUser("OPTIMUS", "password123"))                .thenReturn(mockUserProfileWithTokens);        AuthResult result = userService.createUser(loginDTO);        assertEquals(1L, result.getUserProfile().getId());        assertEquals("OPTIMUS", result.getUserProfile().getLogin());        assertEquals("CLIENT", result.getUserProfile().getRole());        assertEquals("accessTokenus", result.getTokens().getAccessToken());    }    @Test    void authUserShouldReturnAuthResult() {        UserLoginDTO loginDTO = new UserLoginDTO("OPTIMUS", "password123");        when(grpcClientService.authenticate("OPTIMUS", "password123"))                .thenReturn(mockUserProfileWithTokens);        AuthResult result = userService.authUser(loginDTO);        assertEquals(1L, result.getUserProfile().getId());        assertEquals("OPTIMUS", result.getUserProfile().getLogin());        assertEquals("refreshTokenus", result.getTokens().getRefreshToken());    }    @Test    void getUserShouldReturnUserProfileDTO() {        when(grpcClientService.getUser(1L)).thenReturn(mockUserProfile);        UserProfileDTO result = userService.getUser(1L);        assertEquals(1L, result.getId());        assertEquals("testUser", result.getLogin());        assertEquals("test@cu.com", result.getMail());    }    @Test    void getUserMainDataShouldReturnUserMainData() {        when(grpcClientService.GetMainData("testToken")).thenReturn(mockUserMainData);        UserMainData result = userService.getUserMainData(testToken);        assertEquals(1L, result.getId());        assertEquals("CLIENT", result.getRole());    }    @Test    void updateUserShouldReturnAuthResult() {        UserProfileDTO profileDTO =                new UserProfileDTO(1L, "OPTIMUS", "CLIENT", "test@cu.com", "+79991234567");        when(grpcClientService.updateUser(any(UserProfileDTO.class), eq(1L), eq("testToken")))                .thenReturn(mockUserProfileWithTokens);        AuthResult result = userService.updateUser(profileDTO, 1L, testToken);        assertEquals(1L, result.getUserProfile().getId());        assertEquals("OPTIMUS", result.getUserProfile().getLogin());        assertEquals("CLIENT", result.getUserProfile().getRole());    }    @Test    void refreshAccessTokenShouldReturnNewToken() {        Auth.AccessTokenResponse tokenResponse =                Auth.AccessTokenResponse.newBuilder().setAccessToken("newAccessToken").build();        when(grpcClientService.refreshToken("refreshTokenus")).thenReturn(tokenResponse);        String result = userService.refreshAccessToken("refreshTokenus");        assertEquals("newAccessToken", result);    }}