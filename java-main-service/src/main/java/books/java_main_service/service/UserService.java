package books.java_main_service.service;import books.java_main_service.Auth;import books.java_main_service.model.*;import org.springframework.stereotype.Service;@Servicepublic class UserService {    private final GrpcClientService grpcClientService;    public UserService(GrpcClientService grpcClientService) {        this.grpcClientService = grpcClientService;    }    public UserProfileDTO convertUserWithTokensToUserProfileDTO(            Auth.UserProfileWithTokens userProfile) {        UserProfileDTO userProfileDTO = new UserProfileDTO();        userProfileDTO.setId(userProfile.getId());        userProfileDTO.setLogin(userProfile.getLogin());        userProfileDTO.setRole(userProfile.getRole().toString());        userProfileDTO.setMail(userProfile.getMail());        userProfileDTO.setPhone(userProfile.getPhone());        return userProfileDTO;    }    public UserProfileDTO convertUserToUserProfileDTO(Auth.UserProfile userProfile) {        UserProfileDTO userProfileDTO = new UserProfileDTO();        userProfileDTO.setId(userProfile.getId());        userProfileDTO.setLogin(userProfile.getLogin());        userProfileDTO.setRole(userProfile.getRole().toString());        userProfileDTO.setMail(userProfile.getMail());        userProfileDTO.setPhone(userProfile.getPhone());        return userProfileDTO;    }    public TokensDTO extractTokensDTO(Auth.UserProfileWithTokens userProfile) {        TokensDTO tokensDTO = new TokensDTO();        tokensDTO.setAccessToken(userProfile.getAccessToken());        tokensDTO.setRefreshToken(userProfile.getRefreshToken());        return tokensDTO;    }    public AuthResult createUser(UserLoginDTO user) {        Auth.UserProfileWithTokens userProfile =                grpcClientService.addUser(user.getLogin(), user.getPassword());        // Извлекаем нужные данные        UserProfileDTO profileDTO = convertUserWithTokensToUserProfileDTO(userProfile);        TokensDTO tokensDTO = extractTokensDTO(userProfile);        return new AuthResult(profileDTO, tokensDTO);    }    public AuthResult authUser(UserLoginDTO user) {        Auth.UserProfileWithTokens userProfile =                grpcClientService.authenticate(user.getLogin(), user.getPassword());        // Извлекаем нужные данные        UserProfileDTO profileDTO = convertUserWithTokensToUserProfileDTO(userProfile);        TokensDTO tokensDTO = extractTokensDTO(userProfile);        return new AuthResult(profileDTO, tokensDTO);    }    public UserProfileDTO getUser(Long id) {        Auth.UserProfile userProfile = grpcClientService.getUser(id);        return convertUserToUserProfileDTO(userProfile);    }    public UserMainData getUserMainData(String accessToken) {        // Удаляем "Bearer " из токена, если он присутствует        String token = accessToken.startsWith("Bearer ") ? accessToken.substring(7) : accessToken;        Auth.UserMainDataResponse userMainData = grpcClientService.GetMainData(token);        // Извлекаем нужные данные        return new UserMainData(userMainData.getId(), userMainData.getRole().toString());    }    public AuthResult updateUser(UserProfileDTO user, Long id, String accessToken) {        // Удаляем "Bearer " из токена, если он присутствует        String token = accessToken.startsWith("Bearer ") ? accessToken.substring(7) : accessToken;        Auth.UserProfileWithTokens userProfile = grpcClientService.updateUser(user, id, token);        // Извлекаем нужные данные из обновленного профиля        UserProfileDTO profileDTO = convertUserWithTokensToUserProfileDTO(userProfile);        TokensDTO tokensDTO = extractTokensDTO(userProfile);        return new AuthResult(profileDTO, tokensDTO);    }    public String refreshAccessToken(String refreshToken) {        // Вызываем gRPC-сервис для обновления токена        Auth.AccessTokenResponse token = grpcClientService.refreshToken(refreshToken);        // Возвращаем новый access token        return token.getAccessToken();    }    public TokensDTO updatePasswordUser(UserUpdatePasswordDTO user, Long id) {        Auth.TokenResponse tokens = grpcClientService.updatePassword(user, id);        // Извлекаем нужные данные из обновленного профиля        TokensDTO tokensDTO = new TokensDTO();        tokensDTO.setAccessToken(tokens.getAccessToken());        tokensDTO.setRefreshToken(tokens.getRefreshToken());        return tokensDTO;    }}