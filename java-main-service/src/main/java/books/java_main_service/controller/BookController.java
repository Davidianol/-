package books.java_main_service.controller;import books.java_main_service.model.Book;import books.java_main_service.model.BookItem;import books.java_main_service.service.BookService;import io.swagger.v3.oas.annotations.Operation;import io.swagger.v3.oas.annotations.Parameter;import io.swagger.v3.oas.annotations.media.Content;import io.swagger.v3.oas.annotations.media.ExampleObject;import io.swagger.v3.oas.annotations.media.Schema;import io.swagger.v3.oas.annotations.tags.Tag;import jakarta.validation.Valid;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.HttpStatus;import org.springframework.http.ResponseEntity;import org.springframework.web.bind.annotation.*;import java.util.List;@Tag(name = "Books", description = "Books API")@RestController@RequestMapping("/books")public class BookController {    private final BookService bookService;    @Autowired    public BookController(BookService bookService) {        this.bookService = bookService;    }    @GetMapping    @Operation(summary = "Получение всех книг")    public List<Book> getAllBooks() {        return bookService.findAll();    }    @GetMapping("/{id}")    @Operation(summary = "Получение книги по ID")    public ResponseEntity<Book> getBookById(@PathVariable Long id) {        return bookService                .findById(id)                .map(ResponseEntity::ok)                .orElse(ResponseEntity.notFound().build());    }    @GetMapping("/search")    @Operation(summary = "Поиск книг по названию, автору или жанрам")    public List<Book> searchBooks(            @RequestParam(required = false) String query,            @RequestParam(required = false) List<Long> genreIds) {        return bookService.searchBooks(query, genreIds != null ? genreIds : List.of());    }    @PostMapping("/add")    @Operation(summary = "Создание новой книги")    @io.swagger.v3.oas.annotations.parameters.RequestBody(            description = "Пример тела запроса для создания книги",            content =                    @Content(                            mediaType = "application/json",                            schema = @Schema(implementation = Book.class),                            examples =                                    @ExampleObject(                                            name = "Пример книги",                                            value =                                                    """                                {                                    "title": "Война и мир",                                    "author": "Толстой Л.Н.",                                    "description": "Русская классика",                                    "year": 1869,                                    "genres": [{"id": 1}]                                }                                """)))    public ResponseEntity<Book> createBook(            @Valid @RequestBody Book book,            @Parameter(hidden = true) @RequestHeader("Authorization") String accessToken) {        Book savedBook = bookService.save(book, accessToken);        return ResponseEntity.status(HttpStatus.CREATED).body(savedBook);    }    @PostMapping("/{bookId}/items/add")    @Operation(summary = "Создание экземпляра книги для обмена")    @io.swagger.v3.oas.annotations.parameters.RequestBody(            description = "Пример тела запроса для создания книги",            content =                    @Content(                            mediaType = "application/json",                            schema = @Schema(implementation = BookItem.class),                            examples =                                    @ExampleObject(                                            name = "Пример экземпляра книги",                                            value =                                                    """                {                    "condition": "MINIMAL_WEAR",                    "description": "Небольшие потертости",                    "location": "Москва",                    "availableForDeal": true                }                """)))    public ResponseEntity<BookItem> createBookItem(            @PathVariable Long bookId,            @Valid @RequestBody BookItem bookItem,            @Parameter(hidden = true) @RequestHeader("Authorization") String accessToken) {        BookItem savedBookItem = bookService.saveBookItem(bookItem, bookId, accessToken);        return ResponseEntity.status(HttpStatus.CREATED).body(savedBookItem);    }    @GetMapping("/{bookId}/items")    @Operation(summary = "Просмотр всех экземпляров книги")    public ResponseEntity<List<BookItem>> getAllBookItems(@PathVariable Long bookId) {        List<BookItem> bookItems = bookService.getAllBookItems(bookId);        return ResponseEntity.ok(bookItems);    }    @GetMapping("/{bookId}/items/{itemId}")    @Operation(summary = "Получение конкретного экземпляра книги")    public ResponseEntity<BookItem> getBookItem(            @PathVariable Long bookId, @PathVariable Long itemId) {        BookItem bookItem = bookService.getBookItem(bookId, itemId);        return ResponseEntity.ok(bookItem);    }    @GetMapping("{bookId}/items/search")    @Operation(summary = "Поиск экземпляров книг по локации и состоянию")    public List<BookItem> searchBookItems(            @PathVariable Long bookId,            @RequestParam(required = false) String location,            @RequestParam(required = false) String condition) {        return bookService.searchBookItems(bookId, location, condition);    }}